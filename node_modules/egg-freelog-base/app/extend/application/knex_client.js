/**
 * Created by yuliang on 2017/8/14.
 * knex客户端-单例
 */

'use strict'

const singleton = require('./singleton')
const instaceFunc = singleton(function (dbConfig) {
    const knexClients = {}
    const knex = require('knex')
    dbConfig && Object.keys(dbConfig).forEach(name => {
        let selfConfig = dbConfig[name]
        knexClients[name] = knex(selfConfig)
        knexClients[name].on('query-error', selfConfig.error || console.error)
    })
    return knexClients
})

module.exports = dbConfig => {
    if (!dbConfig) {
        throw new Error('未找到knex-db配置文件')
    }
    return instaceFunc(dbConfig)
}



